{"version":3,"sources":["webpack:///./src/pages/webpack/index.mdx","webpack:///./src/utils/i18n.js","webpack:///./src/components/BlogLayout/Translations.js","webpack:///./src/components/BlogLayout/index.js","webpack:///./i18n.js","webpack:///./node_modules/_@babel_runtime@7.12.5@@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent","codeToLanguage","code","supportedLanguages","replace","Translations","render","this","translations","lang","languageLink","editUrl","className","Panel","style","fontFamily","length","map","l","i","Fragment","key","to","href","target","rel","React","Component","BlogLayout","console","log","pageContext","children","location","previous","next","siteTitle","get","langKey","slug","slice","sort","a","b","require","loadFontsForCode","rawSlug","targetLang","createLanguageLink","enSlug","Layout","title","SEO","frontmatter","description","spoiler","date","marginLeft","marginRight","maxWidth","rhythm","color","scale","display","marginBottom","marginTop","formatPostDate","flexWrap","justifyContent","listStyle","padding","fields","query","data","queryData","exports","en","_objectWithoutPropertiesLoose","source","excluded","sourceKeys","Object","keys","indexOf"],"mappings":"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","file":"component---src-pages-webpack-index-mdx-731682c65d29a83a2504.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"C:/Users/lengy/Desktop/gatsby-blog/src/components/BlogLayout/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h2>{`前言`}</h2>\n    <p>{`站在面试角度，webpack核心功能实现无非是plugin，loader。\n更深入一点，自然是同步加载和异步加载。\n如果说到加分项,那优化配置，提高打包速度也都算，但这部分不再本系列中。`}</p>\n    <p>{`本篇为源码系列核心实现第六篇,对应下图webpack部分。`}</p>\n    <p><img parentName=\"p\" {...{\n        \"src\": \"https://lengyuexin.github.io/gatsby/static/src-c54cf51e73a8fdc229c79ea7b981b607.png\",\n        \"alt\": \"src\"\n      }}></img></p>\n    <h2>{`同步加载`}</h2>\n    <h3>{`概述`}</h3>\n    <p>{`不论是同步加载还是异步加载，webpack打包结果都是一个IIFE。\n该IIFE接收一个类型为对象的modules参数， 该参数是一个以模块路径为key,函数为value的对象,其中函数体是文件内容。\n对于每个require语法，都会被替换为`}<strong parentName=\"p\">{`webpack_require`}</strong>{`，每个文件路径都会补全为src下相关路径。\nmodule(打包前),chunk(打包过程中),bundle(打包后) 是同一套代码在webpack打包不同时机的不同称呼。`}</p>\n    <h3>{`实现`}</h3>\n    <p>{`直接丢代码了，关键位置已经加了注释，代码不多，应该比较好理解。`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`(function (modules) {\n\n    //模块缓存\n    var installedModules = {}\n\n    //自己实现的__webpack_require__ 取代原生的require\n    function __webpack_require__(moduleId) {\n\n        //命中缓存 直接返回\n        if (installedModules[moduleId]) {\n            return installedModules[moduleId].exports\n        }\n        //未命中缓存 添加\n        var module = installedModules[moduleId] = {\n            id: moduleId,//模块id\n            load: false,//默认模块没有被加载,\n            exports: {},//导出的内容\n        }\n\n        //加载对应模块\n        //这里的this指向为module.exports貌似是一种规范\n        modules[moduleId].call(\n          module.exports, module, \n          module.exports, __webpack_require__\n          );\n\n        module.load = true//已经加载\n\n        return module.exports\n\n    }\n\n    //加载入口模块\n    return __webpack_require__('./src/index.js')\n\n})(\n\n    {\n        './src/index.js': (function (module, exports, __webpack_require__) {\n            const title = __webpack_require__('./src/title.js')\n            console.log(title)\n        }),\n        './src/title.js': (function (module, exports,) {\n            module.exports = 'hello'\n        })\n\n\n    })\n\n`}</code></pre>\n    <p>{`注意：同步加载用了闭包做缓存，在面试时候这是一个很好的闭包使用场景举例。`}</p>\n    <h2>{`异步加载`}</h2>\n    <h3>{`概述`}</h3>\n    <p>{`首先要明确一点，异步加载包含同步加载。\n最先被加载的入口文件index.js就是同步加载，异步加载指的是其他模块。\n整个异步加载过程其实有三个重要环节:同步加载，e函数，t函数。`}</p>\n    <p>{`同步加载好理解，e函数和t函数是什么东西呢？`}</p>\n    <p>{`e函数内部会通过创建script并指定src去加载其他模块，最后会把加载的依赖结果处理成promise返回。\nt函数内部会进行esmodule和commonjs的兼容处理。`}</p>\n    <h3>{`打包前vs打包后`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`\n//打包前\nlet btn = document.createElement('button')\nbtn.innerText = '按我'\ndocument.body.appendChild(btn)\n\nbtn.addEventListener('click', () => {\n    import(/* webpackChunkName:'title' */'./title').then(res => {\n        console.log(res.default)\n    })\n})\n\n\n//打包后\n\n(function (modules) {\n//...    \n}, {\n    \"./src/index.js\":\n\n        (function (module, exports, __webpack_require__) {\n\n            let btn = document.createElement('button');\n            btn.innerText = '按我';\n            document.body.appendChild(btn);\n            btn.addEventListener('click', () => {\n                __webpack_require__.e(/*! import() | title */ \"title\")\n                    .then(__webpack_require__.t.bind(null, \n                    /*! ./title */ \"./src/title.js\", 7))\n                    .then(res => {\n                        console.log(res.default);\n                    });\n            });\n\n        })\n})\n\n\n\n`}</code></pre>\n    <p>{`e函数之所以能够.then，是因为已经成了promise。\n根据promise的链式调用原理,e函数return的结果会交给t函数继续处理。\n同理，t函数的处理结果也会再次向后传递。\n而此时的结果必然是兼容处理后的，带有default属性的对象。`}</p>\n    <h3>{`异步加载的实现`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`\n\n  // The module cache\n  var installedModules = {};\n\n  // object to store loaded and loading chunks\n  // undefined = chunk not loaded, null = chunk preloaded/prefetched\n  // Promise = chunk loading, 0 = chunk loaded\n  var installedChunks = {\n    \"main\": 0\n  };\n\n\n  function __webpack_require__(moduleId) {\n\n    // Check if module is in cache\n    if (installedModules[moduleId]) {\n      return installedModules[moduleId].exports;\n    }\n    // Create a new module (and put it into the cache)\n    var module = installedModules[moduleId] = {\n      i: moduleId,\n      l: false,\n      exports: {}\n    };\n\n    // Execute the module function\n    modules[moduleId].call(\n      module.exports,\n      module, module.exports,\n      __webpack_require__\n     );\n\n    // Flag the module as loaded\n    module.l = true;\n\n    // Return the exports of the module\n    return module.exports;\n  }\n\n\n  __webpack_require__.e = function (chunkId) {\n\n    var promises = []\n\n    var installedChunkData = installedChunks[chunkId]\n\n     //同样的资源加载后不会加载第二次\n    if (installedChunkData !== 0) {\n      var promise = new Promise(function (resolve, reject) {\n        installedChunkData = installedChunks[chunkId] = [resolve, reject]\n      })\n\n      promises.push(installedChunkData[2] = promise);\n\n      var script = document.createElement('script')\n      script.src = chunkId + '.bundle.js'\n      document.head.appendChild(script)\n    }\n\n\n    return Promise.all(promises)\n\n\n  }\n\n\n  var jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n\n  //核心是push方法\n  jsonpArray.push = webpackJsonpCallback;\n\n\n  // 异步加载的模块结构如下\n\n(window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || []).push([[\"say\"], {\n\n  \"./src/say.js\":\n    (function (module, exports) {\n      module.exports = 'say import ';\n    })\n\n}]);\n\n//该模块被加载就会执行push方法，也就是执行webpackJsonpCallback\n\n// webpackJsonpCallback 接收一个data参数\n// data形如 [[chunkId1,chunkId2],{}]\n  function webpackJsonpCallback(data) {\n    var chunkIds = data[0];\n    var moreModules = data[1];\n\n    var moduleId, chunkId, i resolves = [];\n    for ( var = 0; i < chunkIds.length; i++) {\n         chunkId = chunkIds[i];\n         //存储resolves回调数组\n        resolves.push(installedChunks[chunkId][0]);//[resolve,reject,promise]\n      }\n        //将所有加载后的chunkId标识为已加载\n      installedChunks[chunkId] = 0;\n    }\n\n  //将异步加载的模块与原模块合并，后续会在t函数内部执行一次webpack_require加载\n    for (moduleId in moreModules) {\n        modules[moduleId] = moreModules[moduleId];\n    }\n\n   //取出resolves回调数组并逐步执行\n    while (resolves.length) {\n      resolves.shift()();\n    }\n\n\n//t函数会加载异步合并的代码并进行esmodule和commonjs语法的兼容处理\n//经过t函数处理后的结果必然是一个带有default属性的对象\n//promsie中，返回的内容会在下一个then中获取\n\n// 默认进入时mode是7\n // create a fake namespace object\n  // mode & 1: value is a module id, require it\n  // mode & 2: merge all properties of value into the ns\n  // mode & 4: return value when already ns object\n  // mode & 8|1: behave like require\n  __webpack_require__.t = function (value, mode) {\n\n    if (mode & 1) value = __webpack_require__(value);\n    if (mode & 8) return value;\n    if ((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n    var ns = Object.create(null);\n    __webpack_require__.r(ns);\n    Object.defineProperty(ns, 'default', { enumerable: true, value: value });\n    if (mode & 2 && typeof value != 'string'){\n      for (var key in value){\n         __webpack_require__.d(ns, key,\n          function (key) { return value[key]; }.bind(null, key)\n          );\n      }\n      \n    } \n    return ns;\n  };\n\n\n  };\n\n\n`}</code></pre>\n    <p>{`关键部分已经给出注释，但可能细节上还需要动手多测试，验证。`}</p>\n    <h2>{`loader`}</h2>\n    <h3>{`loader概述`}</h3>\n    <p>{`webpack本身只能处理js文件，loader就是扩展webpack打包能力用的，\n告诉它非js格式文件该怎么处理。比如css相关的style-loader,css-loader。`}</p>\n    <p>{`loader其实和node中的pipe很像，如同流水线，一个loader之后可以接另一个loader。\n但最终，必须是一个js形式收尾。`}</p>\n    <h3>{`实现一个简易loader`}</h3>\n    <p>{`loader的本质是一个函数，该函数通过source参数接收输入，通过返回值输出。\n下面以一个markdown-loader为例，举例说明一个loader是如何实现的。`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`const marked = require('marked')\nmodule.exports = source => {\n  const html = marked(source)\n  return  \\`module.exports = \\${JSON.stringify(html)}\\`\n}\n`}</code></pre>\n    <p>{`这就完事了？是的，就是如此简单。\n测试的话，这个loader可以在webpack的配置文件中以本地路径形式加载。`}</p>\n    <h2>{`plugin`}</h2>\n    <h3>{`plugin概述`}</h3>\n    <p>{`Webpack 的插件本质就是各种钩子，这就像组件生命周期一样，不同阶段存在不同钩子函数。\nwebpack赋予了这些钩子函数特定的能力，直接拿过来用就行了。`}</p>\n    <h3>{`实现一个简易plugin`}</h3>\n    <p>{`plugin可以写成一个类的形式，然后身上有个apply方法，这个是webpack约定好的。\n下面写一个简单的小插件，用于打印构建过程涉及的文件名。`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`class GetFileListPlugin {\n    apply(compiler) {\n        compiler.hooks.emit.tap('GetFileListPlugin ', compilation => {\n            // compilation => 可以理解为此次打包的上下文\n            for (const name in compilation.assets) {\n                console.log(name)\n                const contents = compilation.assets[name].source()\n                compilation.assets[name] = {\n                    //用于返回新内容 \n                    source: () => contents,\n                    //返回内容大小\n                    size: () => noComments.length\n                }\n            }\n        })\n\n    }\n}\n\nmodule.exports = GetFileListPlugin\n\n`}</code></pre>\n    <h2>{`源码压缩包`}</h2>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/lengyuexin/code\"\n        }}>{`https://github.com/lengyuexin/code`}</a></li>\n    </ul>\n    <h2>{`再会`}</h2>\n    <p>{`情如风雪无常,`}</p>\n    <p>{`却是一动既殇。`}</p>\n    <p>{`感谢你这么好看还来阅读我的文章,`}</p>\n    <p>{`我是冷月心,下期再见。`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      ","import { supportedLanguages } from './../../i18n';\r\nimport whitelist from './whitelist';\r\n\r\n// This is kind of a mess for some languages.\r\n// Try to be as short as possible.\r\n// Make sure you use a real code (e.g. \"ja\", not \"jp\").\r\n// Some resources:\r\n// http://www.rfc-editor.org/rfc/bcp/bcp47.txt\r\n// https://www.w3.org/International/articles/language-tags/\r\n// https://www.iana.org/assignments/language-subtag-registry/language-subtag-registry\r\n// https://discuss.httparchive.org/t/what-are-the-invalid-uses-of-the-lang-attribute/1022\r\n\r\nexport const codeToLanguage = code =>\r\n  supportedLanguages[code].replace(/ /g, ' ' /* nbsp */);\r\n\r\nexport const loadFontsForCode = code => {\r\n  switch (code) {\r\n    case 'ru':\r\n    case 'bg':\r\n      require('../fonts/fonts-shared.cyrillic.css');\r\n      require('../fonts/fonts-post.cyrillic.css');\r\n      break;\r\n    case 'uk':\r\n      require('../fonts/fonts-shared.cyrillic.css');\r\n      require('../fonts/fonts-post.cyrillic.css');\r\n      require('../fonts/fonts-shared.latin-ext.css');\r\n      require('../fonts/fonts-post.latin-ext.css');\r\n      break;\r\n    case 'cs':\r\n    case 'da':\r\n    case 'de':\r\n    case 'es':\r\n    case 'fi':\r\n    case 'fr':\r\n    case 'he':\r\n    case 'hu':\r\n    case 'it':\r\n    case 'nl':\r\n    case 'no':\r\n    case 'pl':\r\n    case 'pt-br':\r\n    case 'sk':\r\n    case 'sr':\r\n    case 'sq':\r\n    case 'sv':\r\n    case 'tr':\r\n      require('../fonts/fonts-shared.latin-ext.css');\r\n      require('../fonts/fonts-post.latin-ext.css');\r\n      break;\r\n    case 'vi':\r\n      require('../fonts/fonts-shared.vietnamese.css');\r\n      require('../fonts/fonts-post.vietnamese.css');\r\n      break;\r\n    case 'fa':\r\n      require('../fonts/fonts-post.persian.css');\r\n      break;\r\n    case 'ar':\r\n      require('../fonts/fonts-post.arabic.css');\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n};\r\n\r\n// TODO: the curried signature is weird.\r\nexport const createLanguageLink = (slug, lang) => {\r\n  const rawSlug = slug.replace(`${lang}/`, '');\r\n\r\n  return targetLang =>\r\n    targetLang === 'zh-hans' ? rawSlug : `${targetLang}${rawSlug}`;\r\n};\r\n\r\nexport const replaceAnchorLinksByLanguage = (html, code) => {\r\n  // Match any link using https://regexr.com/4airl\r\n  const matches = html.match(/https?:\\/\\/(www)?[^\\/\\s)\"?]+/gm); // eslint-disable-line\r\n\r\n  // Return same html if no matches were found\r\n  // or code isn't supported\r\n  if (!matches || !supportedLanguages[code]) {\r\n    return html;\r\n  }\r\n\r\n  matches.forEach(url => {\r\n    // Replace to locale url if and only if exists in whitelist\r\n    // and has code registered\r\n    if (whitelist[url] && whitelist[url][code]) {\r\n      html = html.replace(url, whitelist[url][code]);\r\n    }\r\n  });\r\n\r\n  return html;\r\n};\r\n","import React from 'react';\r\nimport { Link } from 'gatsby';\r\n\r\nimport '../../fonts/fonts-post.css';\r\nimport Panel from '../Panel';\r\nimport {\r\n  codeToLanguage,\r\n} from '../../utils/i18n';\r\n\r\nconst systemFont = `system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\",\r\n    \"Roboto\", \"Oxygen\", \"Ubuntu\", \"Cantarell\", \"Fira Sans\",\r\n    \"Droid Sans\", \"Helvetica Neue\", sans-serif`;\r\n\r\nclass Translations extends React.Component {\r\n    render() {\r\n      let { translations, lang, languageLink, editUrl } = this.props;\r\n  \r\n      return (\r\n        <div className=\"translations\">\r\n          <Panel style={{ fontFamily: systemFont }}>\r\n            {translations.length > 0 && (\r\n              <>\r\n                <span>Translated by readers into: </span>\r\n                {translations.map((l, i) => (\r\n                  <React.Fragment key={l}>\r\n                    {l === lang ? (\r\n                      <b>{codeToLanguage(l)}</b>\r\n                    ) : (\r\n                      <Link to={languageLink(l)}>{codeToLanguage(l)}</Link>\r\n                    )}\r\n                    {i === translations.length - 1 ? '' : ' • '}\r\n                  </React.Fragment>\r\n                ))}\r\n              </>\r\n            )}\r\n            {lang !== 'zh-hans' && (\r\n              <>\r\n                  <br />\r\n                  <br />\r\n                  <Link to={languageLink('zh-hans')}>Read the original</Link>\r\n                  {' • '}\r\n                  <a href={editUrl} target=\"_blank\" rel=\"noopener noreferrer\">\r\n                      Improve this translation\r\n                  </a>\r\n                  {' • '}\r\n                  <Link to={`/${lang}`}>View all translated posts</Link>{' '}\r\n              </>\r\n            )}\r\n          </Panel>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  export default Translations;","import React from \"react\"\nimport { Link, graphql, StaticQuery } from \"gatsby\"\nimport get from \"lodash/get\"\n\nimport \"../../fonts/fonts-post.css\"\nimport Layout from \"../Layout\"\nimport SEO from \"../SEO\"\nimport Translations from \"./Translations\"\nimport { formatPostDate } from \"../../utils/helpers\"\nimport { rhythm, scale } from \"../../utils/typography\"\nimport {\n  codeToLanguage,\n  createLanguageLink,\n  loadFontsForCode,\n} from \"../../utils/i18n\"\n\nconst GITHUB_USERNAME = \"gaearon\"\nconst GITHUB_REPO_NAME = \"overreacted.io\"\n\nclass BlogLayout extends React.Component {\n  render() {\n    console.log(this.props)\n\n    let {\n      pageContext,\n      children,\n      location,\n\n      // TODO: 不存在的\n      previous,\n      next,\n      translations,\n    } = this.props\n    const siteTitle = get(this.props, \"queryData.site.siteMetadata.title\")\n    const lang = pageContext.langKey\n    const slug = pageContext.slug\n    // const timeToRead = 0;\n\n    if (translations) {\n      translations = translations.slice()\n      translations.sort((a, b) => {\n        return codeToLanguage(a) < codeToLanguage(b) ? -1 : 1\n      })\n    }\n\n    loadFontsForCode(lang)\n\n    const languageLink = createLanguageLink(slug, lang)\n    // eg: /en/data-post/\n    const enSlug = languageLink(\"en\")\n    const editUrl = `https://github.com/${GITHUB_USERNAME}/${GITHUB_REPO_NAME}/edit/master/src/pages/${enSlug.slice(\n      1,\n      enSlug.length - 1\n    )}/index${lang === \"zh-hans\" ? \"\" : \".\" + lang}.md`\n\n    return (\n      <Layout location={location} title={siteTitle}>\n        <SEO\n          lang={lang}\n          title={pageContext.frontmatter.title}\n          description={pageContext.frontmatter.spoiler}\n          slug={slug}\n          date={pageContext.frontmatter.date}\n        />\n        <div\n          style={{\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            maxWidth: rhythm(24),\n          }}\n        >\n          <article>\n            <header>\n              <h1 style={{ color: \"var(--textTitle)\" }}>\n                {pageContext.frontmatter.title}\n              </h1>\n              <p\n                style={{\n                  ...scale(-1 / 5),\n                  display: \"block\",\n                  marginBottom: rhythm(1),\n                  marginTop: rhythm(-4 / 5),\n                }}\n              >\n                {formatPostDate(pageContext.frontmatter.date, lang)}\n                {/* {` • ${formatReadingTime(timeToRead)}`} */}\n              </p>\n              {translations && translations.length > 0 && (\n                <Translations\n                  translations={translations}\n                  editUrl={editUrl}\n                  languageLink={languageLink}\n                  lang={lang}\n                />\n              )}\n            </header>\n            <div>{children}</div>\n          </article>\n          <aside>\n            <nav>\n              <ul\n                style={{\n                  display: \"flex\",\n                  flexWrap: \"wrap\",\n                  justifyContent: \"space-between\",\n                  listStyle: \"none\",\n                  padding: 0,\n                }}\n              >\n                <li>\n                  {previous && (\n                    <Link\n                      to={previous.fields.slug}\n                      rel=\"prev\"\n                      style={{ marginRight: 20 }}\n                    >\n                      ← {previous.frontmatter.title}\n                    </Link>\n                  )}\n                </li>\n                <li>\n                  {next && (\n                    <Link to={next.fields.slug} rel=\"next\">\n                      {next.frontmatter.title} →\n                    </Link>\n                  )}\n                </li>\n              </ul>\n            </nav>\n          </aside>\n        </div>\n      </Layout>\n    )\n  }\n}\n\nexport default props => {\n  return (\n    <StaticQuery\n      query={graphql`\n        query {\n          site {\n            siteMetadata {\n              title\n              author\n            }\n          }\n        }\n      `}\n      render={data => <BlogLayout queryData={data} {...props} />}\n    />\n  )\n}\n","// Please keep keys lowercase!\r\nexports.supportedLanguages = {\r\n  en: 'English',\r\n  'zh-hans': '简体中文',\r\n  // ru: 'Русский',\r\n  // tr: 'Türkçe',\r\n  // es: 'Español',\r\n  // ko: '한국어',\r\n  // sv: 'Svenska',\r\n  // it: 'Italiano',\r\n  // id: 'Bahasa Indonesia',\r\n  // 'pt-br': 'Português do Brasil',\r\n  // pl: 'Polski',\r\n  // 'zh-hant': '繁體中文',\r\n  // ja: '日本語',\r\n  // fr: 'Français',\r\n  // he: 'עברית',\r\n  // hu: 'Magyar',\r\n  // vi: 'Tiếng Việt',\r\n  // th: 'ไทย',\r\n  // my: 'မြန်မာဘာသာ',\r\n  // sk: 'Slovenčina',\r\n  // te: 'తెలుగు',\r\n  // uk: 'Українська',\r\n  // bg: 'Български',\r\n  // cs: 'Čeština',\r\n  // de: 'Deutsch',\r\n  // nl: 'Nederlands',\r\n  // nb: 'Norsk',\r\n  // fa: 'فارسی',\r\n  // ar: 'العربية',\r\n  // sr: 'srpski',\r\n};\r\n","export default function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}"],"sourceRoot":""}