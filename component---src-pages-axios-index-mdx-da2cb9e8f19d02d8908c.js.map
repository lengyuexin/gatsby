{"version":3,"sources":["webpack:///./src/utils/i18n.js","webpack:///./src/components/BlogLayout/Translations.js","webpack:///./src/components/BlogLayout/index.js","webpack:///./src/pages/axios/index.mdx","webpack:///./i18n.js","webpack:///./node_modules/_@babel_runtime@7.12.5@@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js"],"names":["codeToLanguage","code","supportedLanguages","replace","Translations","render","this","props","translations","lang","languageLink","editUrl","className","Panel","style","fontFamily","length","map","l","i","Fragment","key","to","href","target","rel","React","Component","BlogLayout","console","log","pageContext","children","location","previous","next","siteTitle","get","langKey","slug","slice","sort","a","b","require","loadFontsForCode","rawSlug","targetLang","createLanguageLink","enSlug","Layout","title","SEO","frontmatter","description","spoiler","date","marginLeft","marginRight","maxWidth","rhythm","color","scale","display","marginBottom","marginTop","formatPostDate","flexWrap","justifyContent","listStyle","padding","fields","query","data","queryData","_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","isMDXComponent","exports","en","_objectWithoutPropertiesLoose","source","excluded","sourceKeys","Object","keys","indexOf"],"mappings":"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","file":"component---src-pages-axios-index-mdx-da2cb9e8f19d02d8908c.js","sourcesContent":["import { supportedLanguages } from './../../i18n';\r\nimport whitelist from './whitelist';\r\n\r\n// This is kind of a mess for some languages.\r\n// Try to be as short as possible.\r\n// Make sure you use a real code (e.g. \"ja\", not \"jp\").\r\n// Some resources:\r\n// http://www.rfc-editor.org/rfc/bcp/bcp47.txt\r\n// https://www.w3.org/International/articles/language-tags/\r\n// https://www.iana.org/assignments/language-subtag-registry/language-subtag-registry\r\n// https://discuss.httparchive.org/t/what-are-the-invalid-uses-of-the-lang-attribute/1022\r\n\r\nexport const codeToLanguage = code =>\r\n  supportedLanguages[code].replace(/ /g, ' ' /* nbsp */);\r\n\r\nexport const loadFontsForCode = code => {\r\n  switch (code) {\r\n    case 'ru':\r\n    case 'bg':\r\n      require('../fonts/fonts-shared.cyrillic.css');\r\n      require('../fonts/fonts-post.cyrillic.css');\r\n      break;\r\n    case 'uk':\r\n      require('../fonts/fonts-shared.cyrillic.css');\r\n      require('../fonts/fonts-post.cyrillic.css');\r\n      require('../fonts/fonts-shared.latin-ext.css');\r\n      require('../fonts/fonts-post.latin-ext.css');\r\n      break;\r\n    case 'cs':\r\n    case 'da':\r\n    case 'de':\r\n    case 'es':\r\n    case 'fi':\r\n    case 'fr':\r\n    case 'he':\r\n    case 'hu':\r\n    case 'it':\r\n    case 'nl':\r\n    case 'no':\r\n    case 'pl':\r\n    case 'pt-br':\r\n    case 'sk':\r\n    case 'sr':\r\n    case 'sq':\r\n    case 'sv':\r\n    case 'tr':\r\n      require('../fonts/fonts-shared.latin-ext.css');\r\n      require('../fonts/fonts-post.latin-ext.css');\r\n      break;\r\n    case 'vi':\r\n      require('../fonts/fonts-shared.vietnamese.css');\r\n      require('../fonts/fonts-post.vietnamese.css');\r\n      break;\r\n    case 'fa':\r\n      require('../fonts/fonts-post.persian.css');\r\n      break;\r\n    case 'ar':\r\n      require('../fonts/fonts-post.arabic.css');\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n};\r\n\r\n// TODO: the curried signature is weird.\r\nexport const createLanguageLink = (slug, lang) => {\r\n  const rawSlug = slug.replace(`${lang}/`, '');\r\n\r\n  return targetLang =>\r\n    targetLang === 'zh-hans' ? rawSlug : `${targetLang}${rawSlug}`;\r\n};\r\n\r\nexport const replaceAnchorLinksByLanguage = (html, code) => {\r\n  // Match any link using https://regexr.com/4airl\r\n  const matches = html.match(/https?:\\/\\/(www)?[^\\/\\s)\"?]+/gm); // eslint-disable-line\r\n\r\n  // Return same html if no matches were found\r\n  // or code isn't supported\r\n  if (!matches || !supportedLanguages[code]) {\r\n    return html;\r\n  }\r\n\r\n  matches.forEach(url => {\r\n    // Replace to locale url if and only if exists in whitelist\r\n    // and has code registered\r\n    if (whitelist[url] && whitelist[url][code]) {\r\n      html = html.replace(url, whitelist[url][code]);\r\n    }\r\n  });\r\n\r\n  return html;\r\n};\r\n","import React from 'react';\r\nimport { Link } from 'gatsby';\r\n\r\nimport '../../fonts/fonts-post.css';\r\nimport Panel from '../Panel';\r\nimport {\r\n  codeToLanguage,\r\n} from '../../utils/i18n';\r\n\r\nconst systemFont = `system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\",\r\n    \"Roboto\", \"Oxygen\", \"Ubuntu\", \"Cantarell\", \"Fira Sans\",\r\n    \"Droid Sans\", \"Helvetica Neue\", sans-serif`;\r\n\r\nclass Translations extends React.Component {\r\n    render() {\r\n      let { translations, lang, languageLink, editUrl } = this.props;\r\n  \r\n      return (\r\n        <div className=\"translations\">\r\n          <Panel style={{ fontFamily: systemFont }}>\r\n            {translations.length > 0 && (\r\n              <>\r\n                <span>Translated by readers into: </span>\r\n                {translations.map((l, i) => (\r\n                  <React.Fragment key={l}>\r\n                    {l === lang ? (\r\n                      <b>{codeToLanguage(l)}</b>\r\n                    ) : (\r\n                      <Link to={languageLink(l)}>{codeToLanguage(l)}</Link>\r\n                    )}\r\n                    {i === translations.length - 1 ? '' : ' • '}\r\n                  </React.Fragment>\r\n                ))}\r\n              </>\r\n            )}\r\n            {lang !== 'zh-hans' && (\r\n              <>\r\n                  <br />\r\n                  <br />\r\n                  <Link to={languageLink('zh-hans')}>Read the original</Link>\r\n                  {' • '}\r\n                  <a href={editUrl} target=\"_blank\" rel=\"noopener noreferrer\">\r\n                      Improve this translation\r\n                  </a>\r\n                  {' • '}\r\n                  <Link to={`/${lang}`}>View all translated posts</Link>{' '}\r\n              </>\r\n            )}\r\n          </Panel>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  export default Translations;","import React from \"react\"\nimport { Link, graphql, StaticQuery } from \"gatsby\"\nimport get from \"lodash/get\"\n\nimport \"../../fonts/fonts-post.css\"\nimport Layout from \"../Layout\"\nimport SEO from \"../SEO\"\nimport Translations from \"./Translations\"\nimport { formatPostDate } from \"../../utils/helpers\"\nimport { rhythm, scale } from \"../../utils/typography\"\nimport {\n  codeToLanguage,\n  createLanguageLink,\n  loadFontsForCode,\n} from \"../../utils/i18n\"\n\nconst GITHUB_USERNAME = \"gaearon\"\nconst GITHUB_REPO_NAME = \"overreacted.io\"\n\nclass BlogLayout extends React.Component {\n  render() {\n    console.log(this.props)\n\n    let {\n      pageContext,\n      children,\n      location,\n\n      // TODO: 不存在的\n      previous,\n      next,\n      translations,\n    } = this.props\n    const siteTitle = get(this.props, \"queryData.site.siteMetadata.title\")\n    const lang = pageContext.langKey\n    const slug = pageContext.slug\n    // const timeToRead = 0;\n\n    if (translations) {\n      translations = translations.slice()\n      translations.sort((a, b) => {\n        return codeToLanguage(a) < codeToLanguage(b) ? -1 : 1\n      })\n    }\n\n    loadFontsForCode(lang)\n\n    const languageLink = createLanguageLink(slug, lang)\n    // eg: /en/data-post/\n    const enSlug = languageLink(\"en\")\n    const editUrl = `https://github.com/${GITHUB_USERNAME}/${GITHUB_REPO_NAME}/edit/master/src/pages/${enSlug.slice(\n      1,\n      enSlug.length - 1\n    )}/index${lang === \"zh-hans\" ? \"\" : \".\" + lang}.md`\n\n    return (\n      <Layout location={location} title={siteTitle}>\n        <SEO\n          lang={lang}\n          title={pageContext.frontmatter.title}\n          description={pageContext.frontmatter.spoiler}\n          slug={slug}\n          date={pageContext.frontmatter.date}\n        />\n        <div\n          style={{\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            maxWidth: rhythm(24),\n          }}\n        >\n          <article>\n            <header>\n              <h1 style={{ color: \"var(--textTitle)\" }}>\n                {pageContext.frontmatter.title}\n              </h1>\n              <p\n                style={{\n                  ...scale(-1 / 5),\n                  display: \"block\",\n                  marginBottom: rhythm(1),\n                  marginTop: rhythm(-4 / 5),\n                }}\n              >\n                {formatPostDate(pageContext.frontmatter.date, lang)}\n                {/* {` • ${formatReadingTime(timeToRead)}`} */}\n              </p>\n              {translations && translations.length > 0 && (\n                <Translations\n                  translations={translations}\n                  editUrl={editUrl}\n                  languageLink={languageLink}\n                  lang={lang}\n                />\n              )}\n            </header>\n            <div>{children}</div>\n          </article>\n          <aside>\n            <nav>\n              <ul\n                style={{\n                  display: \"flex\",\n                  flexWrap: \"wrap\",\n                  justifyContent: \"space-between\",\n                  listStyle: \"none\",\n                  padding: 0,\n                }}\n              >\n                <li>\n                  {previous && (\n                    <Link\n                      to={previous.fields.slug}\n                      rel=\"prev\"\n                      style={{ marginRight: 20 }}\n                    >\n                      ← {previous.frontmatter.title}\n                    </Link>\n                  )}\n                </li>\n                <li>\n                  {next && (\n                    <Link to={next.fields.slug} rel=\"next\">\n                      {next.frontmatter.title} →\n                    </Link>\n                  )}\n                </li>\n              </ul>\n            </nav>\n          </aside>\n        </div>\n      </Layout>\n    )\n  }\n}\n\nexport default props => {\n  return (\n    <StaticQuery\n      query={graphql`\n        query {\n          site {\n            siteMetadata {\n              title\n              author\n            }\n          }\n        }\n      `}\n      render={data => <BlogLayout queryData={data} {...props} />}\n    />\n  )\n}\n","import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"C:/Users/lengy/Desktop/gatsby-blog/src/components/BlogLayout/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h2>{`前言`}</h2>\n    <p>{`axios可作为前后端通信的桥梁,十分重要,同样也是面试高频。\n但实际上,axios的功能点拆分来看,并不是很多。主要分为适配器,拦截器,请求发送,请求取消四大部分。\n本篇为源码系列核心实现第二篇,对应下图axios部分。`}</p>\n    <p><img parentName=\"p\" {...{\n        \"src\": \"https://lengyuexin.github.io/gatsby/static/src-c54cf51e73a8fdc229c79ea7b981b607.png\",\n        \"alt\": \"src\"\n      }}></img></p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}></th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}></th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`name`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`desc`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`adapter`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`根据宿主环境适配请求方式`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`interceptor`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`请求拦截器,响应拦截器`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`request`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`发起请求`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`cancel token`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`取消请求`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <h2>{`axios是如何根据不同宿主环境适配请求方式的？`}</h2>\n    <h3>{`环境识别`}</h3>\n    <p>{`axios作为一个http请求库,可用于客户端浏览器,也可以用于nodejs。\n那问题来了,它是如何识别宿主环境的呢？`}</p>\n    <p>{`抛开axios本身,我们来想一下,浏览器环境和node环境,到底有什么差异？`}</p>\n    <p>{`首先document,window,XMLHttpRequest对象是浏览器环境下才有的。\nprocess,global全局对象是node环境下才有的。\n从这点考虑,我们可以使用document,window,XMLHttpRequest,process,global这些对象进行判断。`}</p>\n    <p>{`axios源码中采用了process和XMLHttpRequest。\n通过宿主环境的特有对象识别当前环境,适配出不同环境下的请求方式。`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`function getDefaultAdapter() {\n  var adapter;\n  if (typeof XMLHttpRequest !== 'undefined') {\n    // For browsers use XHR adapter\n    adapter = require('./adapters/xhr');\n  } else if (\n      typeof process !== 'undefined' \n      && Object.prototype.toString.call(process) \n      === '[object process]'\n    ) {\n    // For node use HTTP adapter\n    adapter = require('./adapters/http');\n  }\n  return adapter;\n}\n\nvar defaults = {\n  adapter: getDefaultAdapter(),\n}\n`}</code></pre>\n    <p>{`这部分代码没什么复杂逻辑,根据XMLHttpRequest判定是浏览器环境,实际请求就是xhr。\nnode端相对复杂,使用了Follow Redirects,加强了原生的http和https。`}</p>\n    <h3>{`适配时机`}</h3>\n    <p>{`如果要做适配,放在哪个时机更为合适呢？当然是初始化就安排。\n上边的适配部分导出了一个对象defaults,这个对象被用于创建axios实例。`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`function createInstance(defaultConfig) {\n  var context = new Axios(defaultConfig);\n  var instance = bind(Axios.prototype.request, context);\n  utils.extend(instance, Axios.prototype, context);\n  utils.extend(instance, context);\n  return instance;\n}\n//这里的defaults就是上边导出的包含适配器的defaults\nvar axios = createInstance(defaults);\n\n`}</code></pre>\n    <h2>{`axios的拦截器`}</h2>\n    <h3>{`功能概览`}</h3>\n    <p>{`拦截器分为请求拦截和响应拦截,可设置多个。但一般只会请求设置一个,响应设置一个。`}</p>\n    <p><strong parentName=\"p\">{`请求拦截可用于校验并携带token`}</strong></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`axios.interceptors.request.use(\n    config => {\n        //请求携带token\n        const token=localStorage.getItem('token');\n        token&&(config.headers.Authorization=token);\n        return config\n    },\n    error=>Promise.reject(error)\n)\n\n`}</code></pre>\n    <p><strong parentName=\"p\">{`响应拦截可用于数据处理和错误处理`}</strong></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`\naxios.interceptors.response.use(\n  //直接返回响应主体\n    response => response.data,\n    error=>{\n        const {response} =error;   \n        if(response){\n            //有响应内容 根据不同状态码进行不同处理\n            switch(response.status){\n                case 401:{ \n                    //=>权限处理,一般是未登录 ,可跳转至登录页或提示未登录\n                    break;\n                }\n                case 403:{ \n                    //=>服务器拒绝执行,一般是token过期或直接禁止访问\n                    break;\n                }\n                case 404:{ \n                    //=>资源找不到,可跳转至404页面\n                    break;\n                }           \n            }\n\n        }else{\n            //无响应内容 断网或服务器错误\n            if(!window.navigator.onLine){\n                return Promise.reject(\"网络连接中断,请检查...\")\n            }\n            //服务器错误,直接返回错误信息\n            return Promise.reject(error)\n        }\n    }\n)\n\n\n\n`}</code></pre>\n    <p><strong parentName=\"p\">{`每个设置的拦截器都可以通过eject方法取消拦截`}</strong></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`const req1=axios.interceptors.request.use(config=>{\n  config.headers.count+='req1'\n  return config\n\n})\n//取消请求拦截器\naxios.interceptors.request.eject(req1)\n\nconst res1=axios.interceptors.response.use(config=>{\n  config.headers.count+='res1'\n  return config\n\n})\n//取消响应拦截器\naxios.interceptors.response.eject(res1)\n\n`}</code></pre>\n    <h3>{`拦截器到底是个什么东西？`}</h3>\n    <p>{`看了上边的实现基础使用,也许你会好奇,拦截器本质是什么？\n没什么玄机,其本质就是一个对象,该对象带有成功的处理函数和失败的处理函数。\n看到这是不是想到了promise?是的,就是promise.then接收的两个参数。`}</p>\n    <p>{`拦截器源码中维护了一个InterceptorManager,用于拦截器的管理,包括新增和删除。`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`\nfunction InterceptorManager() {\n  this.handlers = [];\n}\n\nInterceptorManager.prototype.use = function use(fulfilled, rejected) {\n  this.handlers.push({\n    fulfilled: fulfilled,\n    rejected: rejected\n  });\n  //返回值视为id,可用于后续清除无效拦截器\n  return this.handlers.length - 1;\n};\n\nInterceptorManager.prototype.eject = function eject(id) {\n  if (this.handlers[id]) {\n    this.handlers[id] = null;\n  }\n};\n\n//剔除无效的拦截器\nInterceptorManager.prototype.forEach = function forEach(fn) {\n  utils.forEach(this.handlers, function forEachHandler(h) {\n    if (h !== null) {\n      fn(h);\n    }\n  });\n};\n\n\n\n`}</code></pre>\n    <h3>{`拦截器与请求的执行顺序`}</h3>\n    <p>{`请求拦截器2=>请求拦截器1=>请求=>响应拦截器1=>响应拦截器2 `}</p>\n    <p>{`值得注意的是：请求拦截器先加的后执行,响应拦截器先加的先执行。`}</p>\n    <p>{`请求拦截器,实际请求,响应拦截器的执行顺序看起来像一个链条,内部又是怎么串联起来的？\naxios对这部分的实现,让我觉得真是将promise链式调用玩到了极致,看完只觉得震惊。`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`\nfunction Axios(instanceConfig) {\n  this.defaults = instanceConfig;\n  this.interceptors = {\n    request: new InterceptorManager(),\n    response: new InterceptorManager()\n  };\n}\n\nAxios.prototype.request = function request(config) {\n  \n  //...\n\n  // dispatchRequest 实际就是一个xhr\n  var chain = [dispatchRequest, undefined];\n  var promise = Promise.resolve(config);\n\n//请求前置 \n  this.interceptors.request.forEach(function unshiftRequestInterceptors(interceptor) {\n    chain.unshift(interceptor.fulfilled, interceptor.rejected);\n  });\n\n//响应后置 \n  this.interceptors.response.forEach(function pushResponseInterceptors(interceptor) {\n    chain.push(interceptor.fulfilled, interceptor.rejected);\n  });\n\n  while (chain.length) {\n    promise = promise.then(chain.shift(), chain.shift());\n  }\n  return promise;\n};\n\n`}</code></pre>\n    <p>{`上述代码通过前后unshift和push将请求拦截和响应拦截放置在真正请求两侧,然后在while循环\n中通过promsie链式不断向后传递,最后将结果返回。`}</p>\n    <p>{`实际上的chain是这样的,举个例子:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`var chain = [\n  '请求成功拦截2', '请求失败拦截2',  \n  '请求成功拦截1', '请求失败拦截1',  \n   dispatch,  undefined,\n  '响应成功拦截1', '响应失败拦截1',\n  '响应成功拦截2', '响应失败拦截2',\n]\n\n`}</code></pre>\n    <p>{`chain中的相邻两项恰好是对应拦截器的成功回调和失败回调,\n与promise.then(chain.shift(), chain.shift())一一对应。`}</p>\n    <h2>{`发起请求`}</h2>\n    <p>{`接下来就到了关键的时刻,发起请求。其实现并不难,在浏览器端其实就是用了xhr。\n对应相关概念是axios源码中的dispatchRequest和xhr.js。`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`function dispatchRequest(config) {\n    return new Promise((resolve, reject) => {\n        let { method, url, params, data, timeout } = config;\n        let xhr = new XMLHttpRequest();\n        xhr.responseType = \"json\";\n        if (params && typeof params === \"object\") {\n            params = require(\"qs\").stringify(params);\n        } else {\n            params = \"\";\n        }\n        url += (url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + params;\n        xhr.open(method, url, true);\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4) {\n                if (\n                 xhr.status >= 200\n                 && xhr.status < 300\n                 ) {\n                   const data=xhr.response ? xhr.response : xhr.responseText\n                    const res = {\n                      config,\n                      data ,\n                      request: xhr,\n                      status: xhr.status,\n                      statusText: xhr.statusText,\n                  };\n                    resolve(res);\n                } else if (\n                  (\n                    xhr.status < 200 && xhr.status !== 0)\n                   || xhr.status > 400\n                   ) {\n                    reject(\"Error: Request failed with status code \" + xhr.status + \"\");\n                }\n            }\n        };\n\n        xhr.onerror = function () {\n            reject(\"请求失败\");\n        };\n\n        if (timeout) {\n            xhr.ontimeout = function () {\n                reject(\"Error: timeout of \" + timeout + \"ms exceeded\");\n            };\n        }\n\n        let body = null;\n        if (data) {\n            body = JSON.stringify(data);\n        }\n\n        xhr.send(body);\n    });\n}\n\n\n\n`}</code></pre>\n    <p>{`上面代码做了一个简化实现,但其实还可以更精简。是的,上边的一大堆压缩到极致就是三行核心代码。`}</p>\n    <p>{`看到这是不是觉得axios的浏览器端请求也不过如此？对的,它本来也不是多复杂,且依赖的就是xhr。`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`var xhr=new XMLHttpRequest();\nxhr.open('get',url)\nxhr.send(null)\n\n`}</code></pre>\n    <p>{`也许你会问,这就是get请求啊,那其他的请求呢？\naxios的其他http方法实现可以参考下面代码,循环并赋值,其中的request可以视为包装好的xhr。`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`\n// Provide aliases for supported request methods\nutils.forEach(['delete', 'get', 'head', 'options'], \nfunction forEachMethodNoData(method) {\n  Axios.prototype[method] = function(url, config) {\n    return this.request(mergeConfig(config || {}, {\n      method: method,\n      url: url,\n      data: (config || {}).data\n    }));\n  };\n});\n\nutils.forEach(['post', 'put', 'patch'], \nfunction forEachMethodWithData(method) {\n  Axios.prototype[method] = function(url, data, config) {\n    return this.request(mergeConfig(config || {}, {\n      method: method,\n      url: url,\n      data: data\n    }));\n  };\n});\n\n\n`}</code></pre>\n    <h2>{`如何取消某个请求呢？`}</h2>\n    <p>{`爱而不得,果断放手。对于不要的请求,可以直接丢掉。`}</p>\n    <p>{`举个例子:tab频繁切换页面,之前的请求可能还没响应完,但确实不再需要。此时,就可取消请求。`}</p>\n    <h3>{`基本使用`}</h3>\n    <p>{`在看具体实现前,先关注一下使用方式。`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`\nimport axios from 'axios'\n\nconst CancelToken = axios.CancelToken;\nconst isCancel = axios.isCancel;//判断是否是用户自主取消\nconst source = CancelToken.source();\naxios({\n cancelToken: source.token,\n})\n\n\naxios(config).catch(err => {\n    if (isCancel(err)) {\n      console.error(err.msg,);\n    } else {\n      console.log(err);\n    }\n  });\n\n  source.cancel(\"cancel\");\n\n\n`}</code></pre>\n    <p>{`上边都是模板代码,也没啥玄机。获取CancelToken,执行其source函数。\n其返回值是一个对象,对象上有一个token属性,这个token被作为值传递给axios。`}</p>\n    <h3>{`代码实现`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`\nclass Cancel {\n  public msg: string = \"\";\n  constructor(msg: string) {\n    this.msg = msg;\n  }\n}\n\nexport function isCancel(err: any) {\n  return err instanceof Cancel;\n}\nexport class CancelToken {\n  public resolve: any;\n\n  source() {\n    return {\n      token: new Promise((resolve) => {\n        this.resolve = resolve;\n      }),\n      cancel: (msg: string) => {\n        this.resolve(new Cancel(msg));\n      },\n    };\n  }\n}\n\n\n\n//dispatchRequest内部调用\n\nif (config.cancelToken) {\n  config.cancelToken.then((msg: string) => {\n      xhr.abort();\n      reject(msg);\n  });\n}\n\n`}</code></pre>\n    <p><strong parentName=\"p\">{`结合使用,分析一下取消请求的整个过程。`}</strong></p>\n    <ol>\n      <li parentName=\"ol\">{`source()函数执行,CancelToken类内部属性resolve初始化为promise。`}</li>\n      <li parentName=\"ol\">{`axios接收的cancelToken其实就是初始化完的promise。`}</li>\n      <li parentName=\"ol\">{`2中的promise在then函数中调用xhr.abort()完成请求取消,这是最核心的一步。`}</li>\n      <li parentName=\"ol\">{`then函数中调用reject方法将接收的msg报错信息捕获。`}</li>\n      <li parentName=\"ol\">{`这个报错信息来源就是外部source.cancel()执行后,resolve(message)的结果。`}</li>\n      <li parentName=\"ol\">{`axios在xhr外面包了一层Promise,最终,错误信息被catch捕获。`}</li>\n    </ol>\n    <h2>{`axios面试大概会问什么？`}</h2>\n    <h3>{`为什么axios既可以当函数调用,也可以当对象使用`}</h3>\n    <ul>\n      <li parentName=\"ul\">{`axios本质是函数,赋值了一些别名方法,比如get、post方法,可被调用`}</li>\n      <li parentName=\"ul\">{`对象调用是因为获取的是Axios类的实例`}</li>\n      <li parentName=\"ul\">{`最终调用的还是Axios.prototype.request函数。`}</li>\n    </ul>\n    <h3>{`简述axios调用流程。`}</h3>\n    <ul>\n      <li parentName=\"ul\">{`创建axios实例`}</li>\n      <li parentName=\"ul\">{`实际调用的是Axios.prototype.request方法`}</li>\n      <li parentName=\"ul\">{`最终返回promise链式调用结果`}</li>\n      <li parentName=\"ul\">{`请求是在dispatchRequest中派发的，浏览器端本质是xhr`}</li>\n    </ul>\n    <h3>{`聊一聊拦截器？`}</h3>\n    <ul>\n      <li parentName=\"ul\">{`axios.interceptors.request.use添加请求成功和失败拦截器函数`}</li>\n      <li parentName=\"ul\">{`axios.interceptors.response.use添加响应成功和失败拦截器函数`}</li>\n      <li parentName=\"ul\">{`在Axios.prototype.request函数组成promise链式调用时, Interceptors.protype.forEach遍历请求和响应拦截器`}</li>\n      <li parentName=\"ul\">{`通过unshift和push添加到真正发送请求dispatchRequest的两端,从而做到请求前拦截和响应后拦截`}</li>\n      <li parentName=\"ul\">{`拦截器也支持用Interceptors.protype.eject方法移除。`}</li>\n    </ul>\n    <h3>{`axios的取消请求功能是怎么实现的？`}</h3>\n    <ul>\n      <li parentName=\"ul\">{`config配置cancelToken`}</li>\n      <li parentName=\"ul\">{`在promise链式调用的dispatchRequest抛出错误`}</li>\n      <li parentName=\"ul\">{`在adapter中request.abort()取消请求`}</li>\n      <li parentName=\"ul\">{`使promise走向rejected`}</li>\n      <li parentName=\"ul\">{`用户捕获错误信息`}</li>\n    </ul>\n    <h2>{`源码压缩包`}</h2>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/lengyuexin/code\"\n        }}>{`https://github.com/lengyuexin/code`}</a></li>\n    </ul>\n    <h2>{`再会`}</h2>\n    <p>{`情如风雪无常,`}</p>\n    <p>{`却是一动既殇。`}</p>\n    <p>{`感谢你这么好看还来阅读我的文章,`}</p>\n    <p>{`我是冷月心,下期再见。`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      ","// Please keep keys lowercase!\r\nexports.supportedLanguages = {\r\n  en: 'English',\r\n  'zh-hans': '简体中文',\r\n  // ru: 'Русский',\r\n  // tr: 'Türkçe',\r\n  // es: 'Español',\r\n  // ko: '한국어',\r\n  // sv: 'Svenska',\r\n  // it: 'Italiano',\r\n  // id: 'Bahasa Indonesia',\r\n  // 'pt-br': 'Português do Brasil',\r\n  // pl: 'Polski',\r\n  // 'zh-hant': '繁體中文',\r\n  // ja: '日本語',\r\n  // fr: 'Français',\r\n  // he: 'עברית',\r\n  // hu: 'Magyar',\r\n  // vi: 'Tiếng Việt',\r\n  // th: 'ไทย',\r\n  // my: 'မြန်မာဘာသာ',\r\n  // sk: 'Slovenčina',\r\n  // te: 'తెలుగు',\r\n  // uk: 'Українська',\r\n  // bg: 'Български',\r\n  // cs: 'Čeština',\r\n  // de: 'Deutsch',\r\n  // nl: 'Nederlands',\r\n  // nb: 'Norsk',\r\n  // fa: 'فارسی',\r\n  // ar: 'العربية',\r\n  // sr: 'srpski',\r\n};\r\n","export default function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}"],"sourceRoot":""}