---
title: å°é²¸é±¼çš„å‰ä¸–ä»Šç”Ÿ--Docker
date: '2021-03-27'
spoiler: å°é²¸é±¼çš„å‰ä¸–ä»Šç”Ÿ--Docker
---



![](https://img-blog.csdnimg.cn/20210327133426421.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyODEzNDkx,size_16,color_FFFFFF,t_70#pic_center)

## Dockeræ˜¯ä»€ä¹ˆï¼Ÿ

Docker æ˜¯ä¸€ä¸ªç”±goè¯­è¨€ç¼–å†™çš„ï¼Œå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ã€‚

å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„é•œåƒä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„Linuxæˆ–Windowsæœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚

å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ã€‚


## DockerèƒŒåçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

### Dockeræ¶æ„

å®ç°ä¸€ä¸ªå®Œæ•´çš„å®¹å™¨ï¼Œéœ€è¦ Namespaceã€Cgroups å’Œè”åˆæ–‡ä»¶ç³»ç»Ÿè¿™ä¸‰é¡¹LinuxæŠ€æœ¯çš„æ”¯æ’‘ã€‚

![](https://img-blog.csdnimg.cn/20210327133512825.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyODEzNDkx,size_16,color_FFFFFF,t_70#pic_center)




### Namespace

Namespace æ˜¯ Linux å†…æ ¸ç”¨æ¥éš”ç¦»å†…æ ¸èµ„æºçš„ä¸€ç§æ–¹å¼ã€‚

é€šè¿‡Namespaceå¯ä»¥å¯¹æŸäº›è¿›ç¨‹è¿›è¡Œé™åˆ¶ï¼Œä½¿å¾—å…¶åªèƒ½è®¿é—®ä¸è‡ªèº«ç›¸å…³çš„é‚£éƒ¨åˆ†èµ„æºï¼Œå…¶ä»–èµ„æºä¸å¯è§ã€‚

å¦‚æ­¤ï¼Œä¸åŒè¿›ç¨‹ä¹‹é—´ä¹Ÿæ˜¯ç›¸äº’æ— æ„ŸçŸ¥çš„ã€‚

è¿™ç§éš”ç¦»è¦†ç›–é¢ååˆ†å¹¿æ³›ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼šéš”ç¦»è¿›ç¨‹ IDã€ä¸»æœºåã€ç”¨æˆ· IDã€æ–‡ä»¶åã€ç½‘ç»œè®¿é—®å’Œè¿›ç¨‹é—´é€šä¿¡ç­‰ç›¸å…³èµ„æºã€‚

åœ¨Docker çš„ä¸–ç•Œä¸­ï¼Œä¸»è¦ç”¨åˆ°ä»¥ä¸‹å…­ç§å‘½åç©ºé—´ã€‚
- pid namespaceï¼šéš”ç¦»è¿›ç¨‹ ID
- net namespaceï¼šéš”ç¦»ç½‘ç»œæ¥å£
- mnt namespaceï¼šéš”ç¦»æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹
- ipc namespaceï¼šéš”ç¦»è¿›ç¨‹é—´é€šä¿¡(å¦‚:ä¿¡å·é‡,æ¶ˆæ¯é˜Ÿåˆ—å’Œå…±äº«å†…å­˜)
- uts namespaceï¼šéš”ç¦»ä¸»æœºåå’ŒåŸŸåã€‚
- user namespace : éš”ç¦»ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œå¯å®ç°dockerå†…æ‹¥æœ‰rootæƒé™è€Œåœ¨ä¸»æœºä¸Šåªæ˜¯æ™®é€šç”¨æˆ·

æ­£æ˜¯ç”±äº Docker ä½¿ç”¨äº† Linux çš„è¿™äº› Namespace æŠ€æœ¯ï¼Œæ‰å®ç°äº† Docker å®¹å™¨çš„éš”ç¦»ã€‚

### Cgroups 

Cgroups æ˜¯æ§åˆ¶ç»„ç¾¤ï¼ˆcontrol groupsï¼‰çš„ç®€å†™ï¼Œå¯ç”¨äºé™åˆ¶ã€æ§åˆ¶ä¸åˆ†ç¦»ä¸€ä¸ªè¿›ç¨‹ç»„çš„èµ„æºï¼ˆå¦‚CPUã€å†…å­˜ã€ç£ç›˜è¾“å…¥è¾“å‡ºç­‰ï¼‰ã€‚

åœ¨Docker çš„ä¸–ç•Œä¸­ï¼ŒCgroups é€šå¸¸ç”¨æ¥é™åˆ¶å®¹å™¨çš„ CPU å’Œå†…å­˜ç­‰èµ„æºçš„ä½¿ç”¨ã€‚
- èµ„æºé™åˆ¶ : é™åˆ¶èµ„æºçš„ä½¿ç”¨é‡(å¦‚é€šè¿‡é™åˆ¶æŸä¸ªä¸šåŠ¡çš„å†…å­˜ä¸Šé™ï¼Œä¿æŠ¤ä¸»æœºå…¶ä»–ä¸šåŠ¡çš„å®‰å…¨è¿è¡Œ)ã€‚
- ä¼˜å…ˆçº§æ§åˆ¶ : ä¸åŒçš„ç»„å¯ä»¥æœ‰ä¸åŒçš„èµ„æºï¼ˆ CPU ã€ç£ç›˜ IO ç­‰ï¼‰ä½¿ç”¨ä¼˜å…ˆçº§ã€‚
- å®¡è®¡ ï¼šè®¡ç®—æ§åˆ¶ç»„çš„èµ„æºä½¿ç”¨æƒ…å†µã€‚
- æ§åˆ¶ ï¼šæ§åˆ¶è¿›ç¨‹çš„æŒ‚èµ·æˆ–æ¢å¤ã€‚

![](https://img-blog.csdnimg.cn/20210327133655902.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyODEzNDkx,size_16,color_FFFFFF,t_70#pic_center)



### è”åˆæ–‡ä»¶ç³»ç»Ÿ

è”åˆæ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ç§åˆ†å±‚ã€è½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹ã€‚

åœ¨Docker çš„ä¸–ç•Œä¸­ï¼Œè”åˆæ–‡ä»¶ç³»ç»Ÿä¸ºå®¹å™¨æä¾›æ„å»ºå±‚ï¼Œä½¿å¾—å®¹å™¨å¯ä»¥å®ç°å†™æ—¶å¤åˆ¶ä»¥åŠé•œåƒçš„åˆ†å±‚æ„å»ºå’Œå­˜å‚¨ã€‚

é•œåƒæœ¬èº«æ˜¯åªè¯»çš„ï¼Œåœ¨è¿è¡ŒæŸä¸ªå®¹å™¨çš„æ—¶å€™ï¼Œä¼šåœ¨é•œåƒå¤–å±‚é™„åŠ ä¸€ä¸ªå¯è¯»å†™å±‚ï¼Œè¿™ä¹Ÿæ˜¯åŸºäºè”åˆæ–‡ä»¶ç³»ç»Ÿå®ç°çš„ã€‚

```
FROM busybox
COPY test /tmp/test
RUN mkdir /tmp/testdir
```

ä¸Šè¿°æ¯ä¸€è¡Œå‘½ä»¤éƒ½ä¼šç”Ÿæˆä¸€ä¸ªé•œåƒå±‚ï¼Œå½“ä¸åŒçš„é•œåƒä¹‹é—´æœ‰ç›¸åŒçš„é•œåƒå±‚æ—¶ï¼Œä¾¿å¯ä»¥å®ç°ä¸åŒçš„é•œåƒä¹‹é—´å…±äº«é•œåƒå±‚çš„æ•ˆæœã€‚ï¼ˆæ¯”å¦‚åŸºäºbaseé•œåƒæ‰©å±•çš„é•œåƒï¼‰

![](https://img-blog.csdnimg.cn/20210327133835851.png#pic_center)


é•œåƒå±‚å…±äº«è¿™ä¸ªåŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œæ¯ä¸€å±‚éƒ½å¯ä»¥å…±äº«ã€‚

![](https://img-blog.csdnimg.cn/20210327133849751.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyODEzNDkx,size_16,color_FFFFFF,t_70#pic_center)


### æ“ä½œç³»ç»Ÿå±‚é¢çš„è™šæ‹ŸåŒ–

ä»¥ä¸Šè¿™ç§å¯¹è¿›ç¨‹è¿›è¡Œå°è£…éš”ç¦»çš„æŠ€æœ¯ï¼Œå±äºæ“ä½œç³»ç»Ÿå±‚é¢çš„è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚éš”ç¦»çš„è¿›ç¨‹ç‹¬ç«‹äºå®¿ä¸»å’Œå…¶å®ƒçš„éš”ç¦»çš„è¿›ç¨‹ï¼Œå› æ­¤ä¹Ÿç§°å…¶ä¸ºå®¹å™¨ã€‚å®¹å™¨æœ¬è´¨æ˜¯ä¸€ä¸ªå—é™åˆ¶çš„è¿›ç¨‹ï¼Œå®ƒæ²¡åŠæ³•åƒç›´æ¥è¿è¡Œåœ¨ä¸»æœºä¸Šçš„è¿›ç¨‹é‚£æ ·è·å–ä¸»æœºä¸Šçš„è¿›ç¨‹ã€ç¯å¢ƒå˜é‡ã€ç½‘ç»œç­‰ä¿¡æ¯ã€‚ 

è¯¥æŠ€æœ¯æœ€åˆå®ç°æ˜¯åŸºäº LXC(Linux Container)ï¼Œä» 0.7 ç‰ˆæœ¬ä»¥åå¼€å§‹å»é™¤ LXCï¼Œè½¬è€Œä½¿ç”¨è‡ªè¡Œå¼€å‘çš„ libcontainerã€‚ä»è‡ª1.11ç‰ˆæœ¬å¼€å§‹ï¼Œè¿›ä¸€æ­¥æ¼”è¿›ä¸ºä½¿ç”¨ runC å’Œ containerdã€‚

## å®¢æˆ·ç«¯/æœåŠ¡ç«¯æ¨¡å¼

![](https://img-blog.csdnimg.cn/20210327134013950.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyODEzNDkx,size_16,color_FFFFFF,t_70#pic_center)


### docker
å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šDockerå’ŒMySQLä¸€æ ·ï¼Œä¹Ÿæ˜¯å®¢æˆ·ç«¯-æœåŠ¡ç«¯çš„æ¨¡å¼ã€‚Docker å®¢æˆ·ç«¯å…¶å®æ˜¯ä¸€ç§æ³›ç§°ï¼Œç”¨æˆ·å¯é€šè¿‡ docker å‘½ä»¤æˆ–è€…ç›´æ¥è¯·æ±‚ REST API çš„æ–¹å¼ä¸ Docker æœåŠ¡ç«¯äº¤äº’ã€‚

### dockerd
Docker æœåŠ¡ç«¯æ˜¯ Docker æ‰€æœ‰åå°æœåŠ¡çš„ç»Ÿç§°ã€‚å…¶ä¸­ dockerd æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„åå°ç®¡ç†è¿›ç¨‹ï¼Œå®ƒè´Ÿè´£å“åº”å’Œå¤„ç†æ¥è‡ª Docker å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç„¶åå°†å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬åŒ–ä¸º Docker çš„å…·ä½“æ“ä½œã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­dockerd ä¼šé€šè¿‡grpc(ä¸€ä¸ªrpcæ¡†æ¶)ä¸containerdé€šä¿¡ï¼Œcontainerdä½œä¸ºdockerdçš„ä¸‹å±‚æœåŠ¡ã€‚

### runC
runCæ˜¯ä¸€ä¸ªæ ¹æ®OCI(å¼€æ”¾å®¹å™¨æ ‡å‡†)è§„èŒƒç”Ÿæˆå’Œè¿è¡Œå®¹å™¨çš„CLIå·¥å…·,å¯é€šè¿‡å‘½ä»¤è¡Œçš„å½¢å¼æ§åˆ¶å®¹å™¨çš„é”€æ¯ä¸åˆ›å»ºã€‚

### contained
containerd æ˜¯ dockerd å’Œ runC ä¹‹é—´çš„ä¸€ä¸ªä¸­é—´äº¤æµç»„ä»¶ï¼Œdocker å¯¹å®¹å™¨çš„ç®¡ç†å’Œæ“ä½œåŸºæœ¬éƒ½æ˜¯é€šè¿‡ containerd å®Œæˆçš„ã€‚ä¾‹å¦‚ï¼šå®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€é•œåƒç®¡ç†ã€‚

### containerd-shim 
containerdé€šè¿‡containerd-shim å¯åŠ¨å¹¶ç®¡ç† runCï¼Œcontainerd-shimä¸»è¦ä½œç”¨æ˜¯å¯ä»¥åœ¨ä¸ä¸­æ–­å®¹å™¨è¿è¡Œçš„æƒ…å†µä¸‹å‡çº§æˆ–é‡å¯ dockerdã€‚


## Dockerä¸è™šæ‹ŸåŒ–æŠ€æœ¯

è™šæ‹ŸåŒ–æŠ€æœ¯æŒ‡çš„æ˜¯é€šè¿‡éšè—ç‰¹å®šè®¡ç®—å¹³å°çš„å®é™…ç‰©ç†ç‰¹æ€§ï¼Œä¸ºç”¨æˆ·æä¾›æŠ½è±¡ã€ç»Ÿä¸€ã€æ¨¡æ‹Ÿçš„è®¡ç®—ç¯å¢ƒã€‚è¿™ç§è®¡ç®—ç¯å¢ƒï¼Œä¹Ÿè¢«ç§°ä¸ºè™šæ‹Ÿæœºã€‚

Docker æ˜¯å¯¹Linuxå®¹å™¨çš„ä¸€ç§å°è£…ï¼Œå…·æœ‰é«˜æ€§èƒ½ï¼Œä½å¼€é”€ï¼Œæ¥å£ç®€å•æ˜“ç”¨ç­‰ç‰¹ç‚¹ã€‚çœŸæ­£ä½¿å…¶è¶…è¿‡å…¶ä»–åŒç±»äº§å“ï¼Œè¿…é€Ÿå é¢†å¸‚åœºï¼Œæˆä¸ºç›®å‰æœ€æµè¡Œçš„Linuxå®¹å™¨æŠ€æœ¯è§£å†³æ–¹æ¡ˆçš„æ ¹æœ¬æ˜¯Dockerå¼•å…¥äº†é•œåƒåŠŸèƒ½ã€‚

ä¸ç³»ç»Ÿçº§åˆ«çš„è™šæ‹Ÿæœºä¸åŒï¼Œå®¹å™¨æŠ€æœ¯çš„è™šæ‹Ÿå…¶å®æ˜¯è¿›ç¨‹çº§åˆ«çš„ã€‚


![](https://img-blog.csdnimg.cn/20210327134124693.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyODEzNDkx,size_16,color_FFFFFF,t_70#pic_center)




ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè™šæ‹Ÿæœºæ˜¯é€šè¿‡åœ¨å®¿ä¸»æœºä¸Šå¯åŠ¨ä¸€ä¸ªè™šæ‹Ÿæœºç›‘è§†å™¨ HyperVisor æ¥ç®¡ç†æ§åˆ¶è™šæ‹Ÿæœºçš„ï¼Œæœ€ç»å…¸çš„ HyperVisor å°±æ˜¯ VirtualBoxã€‚ä¸å®¹å™¨ç›¸æ¯”ï¼Œè™šæ‹ŸæœºåŒ…å«äº†æ•´ä¸ªå®¢æˆ·æ“ä½œç³»ç»Ÿï¼Œè¿™ä¹Ÿæ˜¯äºŒè€…æ€§èƒ½å·®å¼‚çš„ä¸»è¦æˆå› ã€‚

- ä»å¯åŠ¨è§’åº¦æ¥çœ‹ï¼Œè¿›ç¨‹çº§åˆ«çš„å®¹å™¨å¯åŠ¨è‚¯å®šæ˜¯æ¯”ç³»ç»Ÿçº§åˆ«çš„è™šæ‹Ÿæœºå¯åŠ¨è¦å¿«å¾—å¤šã€‚
- ä»èµ„æºå ç”¨è§’åº¦æ¥çœ‹ï¼Œå®¹å™¨æ˜¯æŒ‰éœ€å ç”¨ï¼Œè™šæ‹Ÿæœºæ˜¯å…¨é‡å ç”¨ã€‚
- ä»èµ„æºåˆ©ç”¨ç‡è§’åº¦æ¥çœ‹ï¼Œå¤šå®¹å™¨å¯ä»¥å…±äº«èµ„æºï¼Œè€Œè™šæ‹Ÿæœºæ˜¯ç‹¬äº«èµ„æºã€‚
- ä»æ„å»ºè§’åº¦æ¥çœ‹ï¼Œå®¹å™¨æ˜¯æŒ‰éœ€æ„å»ºï¼Œä½“ç§¯å°ï¼›è™šæ‹Ÿæœºæ˜¯å…¨é‡æ„å»ºï¼Œä½“ç§¯å¤§ã€‚


![](https://img-blog.csdnimg.cn/20210327134154541.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyODEzNDkx,size_16,color_FFFFFF,t_70#pic_center)




## Dockerè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

Dockeræ˜¯å®¹å™¨æŠ€æœ¯çš„ä¸€ç§ä½“ç°ï¼Œè€Œå®¹å™¨æŠ€æœ¯çš„æ ¹æœ¬æ˜¯ä¸ºäº†æŠ¹å¹³è½¯ä»¶è¿è¡Œçš„ç¯å¢ƒå·®å¼‚ã€‚

å¦‚ä½•æŠ¹å¹³ï¼Ÿ

Dockeré€šè¿‡buildå‘½ä»¤å°†åº”ç”¨ç¨‹åºå’Œå…¶ä¾èµ–æ„å»ºæˆé•œåƒæ–‡ä»¶ï¼Œé•œåƒæ˜¯åªè¯»çš„ï¼Œè¿™æ„å‘³ç€æ„å»ºå®Œæˆåï¼Œé•œåƒä¸ä¼šå†å‘ç”Ÿä»»ä½•å˜åŒ–ã€‚å¦‚æ­¤ï¼ŒåŸºäºè¯¥é•œåƒå¯åŠ¨çš„å®¹å™¨ç¯å¢ƒå¿…ç„¶ä¸€è‡´ã€‚åŒç†ï¼Œè·‘åœ¨è¿™ä¸ªå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºæ‰€å¤„ç¯å¢ƒä¹Ÿä¸€è‡´ã€‚

æ­¤å¤–ï¼Œå®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œå®¹å™¨ç›¸äº’ä¹‹é—´å®Œå…¨éš”ç¦»ï¼Œäº’ä¸å½±å“ã€‚

## Docker æœ‰å“ªäº›é€‚ç”¨åœºæ™¯ï¼Ÿ

- æä¾›åº”ç”¨è¿è¡Œç¯å¢ƒï¼Œè¾…åŠ©CI/CDå·¥ä½œæµ
- ä½œä¸ºServerlessçš„åº•å±‚ä¾èµ–ï¼ŒåŠ¨æ€æ‰©ç¼©å®¹
- æ­å»ºå¾®æœåŠ¡æ¶æ„ï¼Œå¯é€šè¿‡å¤šå®¹å™¨è¿è¡Œå¤šæœåŠ¡çš„å½¢å¼å¯¹å¤æ‚é¡¹ç›®è¿›è¡Œæ‹†è§£
- éƒ¨ç½²ç¯å¢ƒè¿ç§»
- other...


## æ ¸å¿ƒæ¦‚å¿µ

### é•œåƒ

Docker é•œåƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒåŒ…å«äº†å®¹å™¨è¿è¡Œæ—¶æ‰€éœ€è¦çš„æ‰€æœ‰åŸºç¡€æ–‡ä»¶å’Œé…ç½®ä¿¡æ¯ï¼Œæ˜¯å®¹å™¨å¯åŠ¨çš„åŸºç¡€ã€‚è¿™å°±æ„å‘³ç€ï¼Œå¿…é¡»å…ˆæœ‰é•œåƒæ‰èƒ½å¯åŠ¨å®¹å™¨ã€‚

é•œåƒå¯ä»¥è‡ªå·±æ„å»ºä¹Ÿå¯ä»¥ä»é•œåƒä»“åº“æ‹‰å–ã€‚



### å®¹å™¨

é•œåƒå’Œå®¹å™¨çš„å…³ç³»å°±å¥½åƒç±»å’Œå®ä¾‹çš„å…³ç³»ã€‚ä¸€ä¸ªç±»å¯ä»¥æœ‰å¾ˆå¤šå®ä¾‹ï¼Œä¸€ä¸ªé•œåƒä¹Ÿå¯ä»¥æœ‰å¾ˆå¤šå®¹å™¨ã€‚
å®¹å™¨ä¸å¯ä»¥è„±ç¦»é•œåƒå­˜åœ¨ã€‚äº‹å®ä¸Šï¼Œå¯ä»¥ç†è§£ä¸ºå®¹å™¨=å®¹å™¨å±‚(å¯å†™)+é•œåƒï¼ˆåªè¯»ï¼‰ã€‚

![](https://img-blog.csdnimg.cn/20210327134407767.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyODEzNDkx,size_16,color_FFFFFF,t_70#pic_center)



**å†™æ—¶å¤åˆ¶**

è¿™éƒ¨åˆ†æ¶‰åŠåˆ°ä¸€ä¸ªå†™æ—¶å¤åˆ¶ï¼ˆcopy-on-writeï¼‰çš„æŠ€æœ¯ï¼Œèƒ½å¤Ÿæœ‰æ•ˆçš„æé«˜ç£ç›˜çš„åˆ©ç”¨ç‡ã€‚
å°¤å…¶æ˜¯å¯¹è¯»æ“ä½œï¼Œååˆ†çš„å‹å¥½ã€‚

- å†™æ—¶å¤åˆ¶ä¼šå°†è¦ä¿®æ”¹çš„å†…å®¹ä»é•œåƒæ‹·è´åˆ°å®¹å™¨çš„å¯è¯»å†™å±‚ï¼Œå¹¶ä¸ä¼šç›´æ¥ä¿®æ”¹é•œåƒçš„æºæ–‡ä»¶ã€‚
- è¿™æ„å‘³ç€å³ä¾¿æ˜¯å†™çš„æ—¶å€™æœ‰å…¶ä»–å®¹å™¨å¯¹åŒä¸€é•œåƒèµ„æºè¿›è¡Œè¯»å–ï¼Œä¹Ÿä¸ä¼šå‘ç”Ÿèµ„æºä¸ä¸€è‡´çš„æƒ…å†µã€‚
- å¤šå®¹å™¨æ“ä½œåŒä¸€ä¸ªæ–‡ä»¶ä¹Ÿæ˜¯å„è‡ªåœ¨è‡ªå·±çš„å®¹å™¨ç©ºé—´åˆ›å»ºè¯»å†™å±‚å¹¶å®Œæˆä¿®æ”¹ï¼Œç›¸äº’éš”ç¦»ï¼Œäº’ä¸å½±å“ã€‚

**ç”Ÿå‘½å‘¨æœŸ**

æ¯ä¸€ä¸ªå®¹å™¨å®Œæ•´ç”Ÿå‘½å‘¨æœŸéƒ½å…·æœ‰åˆ›å»ºï¼Œè¿è¡Œï¼Œåœæ­¢ï¼Œæš‚åœï¼Œåˆ é™¤è¿™äº”ä¸ªçŠ¶æ€ã€‚

![](https://img-blog.csdnimg.cn/20210327134432643.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyODEzNDkx,size_16,color_FFFFFF,t_70#pic_center)


- åˆ›å»ºï¼šå®¹å™¨è¢«åˆ›å»ºï¼Œæ‰€éœ€èµ„æºå·²å°±ç»ªï¼Œå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºå°šæœªè¿è¡Œã€‚
- è¿è¡Œï¼šå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œã€‚
- æš‚åœï¼šå®¹å™¨ä¸­çš„æ‰€æœ‰åº”ç”¨ç¨‹åºéƒ½å¤„äºæš‚åœ ( éåœæ­¢ ) çŠ¶æ€ã€‚
- åœæ­¢ï¼šå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºå‡å·²åœæ­¢ï¼Œä½†æ‰€å ç”¨èµ„æºä¸ä¼šé‡Šæ”¾ã€‚
- åˆ é™¤ï¼šå®¹å™¨å·²åˆ é™¤ï¼Œæ‰€å ç”¨èµ„æºå…¨éƒ¨é‡Šæ”¾ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šå¦‚æœè¦åˆ é™¤ä¸€ä¸ªé•œåƒï¼Œå¿…é¡»ä¿è¯æ²¡æœ‰å®¹å™¨å ç”¨ï¼Œåœæ­¢çŠ¶æ€çš„å®¹å™¨ä¹Ÿä¸è¡Œã€‚

![](https://img-blog.csdnimg.cn/20210327134504748.png#pic_center)


### ä»“åº“
Docker çš„é•œåƒä»“åº“(public/private)ç±»ä¼¼äºä»£ç ä»“åº“ï¼Œå¯ä»¥ç”¨æ¥å­˜å‚¨å’Œåˆ†å‘ Docker é•œåƒã€‚
é•œåƒï¼Œå®¹å™¨ï¼Œä»£ç ä»“åº“ä¸‰è€…å…³ç³»å¦‚ä¸‹:


![](https://img-blog.csdnimg.cn/20210327134527844.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyODEzNDkx,size_16,color_FFFFFF,t_70#pic_center)


## å®‰è£…


å®˜æ–¹å®‰è£…æ–¹å¼ Docker Desktop

Docker Desktop å…¶æœ¬è´¨æ˜¯å€ŸåŠ©windowså’ŒmacOSçš„å¹³å°ç‰¹æ€§ï¼Œæ­å»ºäº†ä¸€ä¸ªLinuxç¯å¢ƒ,è¿›è€Œè¿è¡Œdockerã€‚

![](https://img-blog.csdnimg.cn/20210327134625993.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyODEzNDkx,size_16,color_FFFFFF,t_70#pic_center)

- [mac](https://hub.docker.com/editions/community/docker-ce-desktop-mac/):https://hub.docker.com/editions/community/docker-ce-desktop-mac/
- [windows](https://hub.docker.com/editions/community/docker-ce-desktop-windows/):https://hub.docker.com/editions/community/docker-ce-desktop-windows/

### é•œåƒåŠ é€Ÿ

ä¸ºä½¿å¾—åœ¨å›½å†…ä»Docker Hubæ‹‰å–é•œåƒæ›´å¿«ï¼Œå¯ä»¥é…ç½®é•œåƒåŠ é€Ÿå™¨ã€‚
- [é˜¿é‡Œäº‘åŠ é€Ÿå™¨(æ§åˆ¶å° -> ç™»å½•è´¦å·-> åº”ç”¨æœç´¢å®¹å™¨é•œåƒæœåŠ¡ -> ä¾§è¾¹æ é€‰æ‹©é•œåƒåŠ é€Ÿå™¨ -> å¤åˆ¶åœ°å€)](https://www.aliyun.com/product/acr?source=5176.11533457&userCode=8lx5zmtu)
- [ç½‘æ˜“äº‘åŠ é€Ÿå™¨](https://hub-mirror.c.163.com) https://hub-mirror.c.163.com
- [ç™¾åº¦äº‘åŠ é€Ÿå™¨](https://mirror.baidubce.com) https://mirror.baidubce.com
- ç”±äºé•œåƒæœåŠ¡å¯èƒ½å‡ºç°å®•æœºï¼Œå»ºè®®åŒæ—¶é…ç½®å¤šä¸ªé•œåƒã€‚

### é…ç½®æ–¹å¼
ä¸‹è½½å®‰è£…å®˜æ–¹æä¾›çš„Docker Desktopåï¼Œç‚¹å‡»dockerå›¾æ ‡ï¼Œé€‰æ‹©setting(windows)æˆ–è€…preferences(macOS)é¢æ¿ï¼Œåˆ‡æ¢åˆ°docker engine ,ç¼–è¾‘jsonæ–‡ä»¶ï¼ŒåŠ å…¥é•œåƒæºåœ°å€åç‚¹å‡»å³ä¸‹è§’çš„Apply&Restartã€‚

![](https://img-blog.csdnimg.cn/20210327134932604.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyODEzNDkx,size_16,color_FFFFFF,t_70#pic_center)


### å®‰è£…æ£€æµ‹
å‘½ä»¤è¡Œè¾“å…¥docker info åå…³æ³¨Registry Mirrors

![](https://img-blog.csdnimg.cn/20210327134957227.png#pic_center)




### Hello world

æœ¬ç¤ºä¾‹å°†å±•ç¤ºä¸€ä¸ªç®€å•çš„koa serverå¦‚ä½•åœ¨dockerä¸­è·‘èµ·æ¥ã€‚

**1. åˆ›å»ºé¡¹ç›®koa-server**

```
# æ–°å»ºæ–‡ä»¶å¤¹
mkdir koa-server
# è¿›å…¥
cd koa-server
# é¡¹ç›®åˆå§‹åŒ–ï¼Œç”Ÿæˆpackage.json
npm init -y
# å®‰è£…koa
npm i koa 
# æ–°å»ºapp.js
touch app.js

# åœ¨app.jsä¸­å†™å…¥å¦‚ä¸‹ä»£ç 
const Koa=require('koa')
const app=new Koa()
app.use(ctx=>{
    ctx.body='hello koa'
})
app.listen(3000,()=>{
    console.log('run server__')
})

```

**2. ç¼–å†™Dockerfileæ–‡ä»¶ï¼Œæ ¹æ®å…¶æè¿°æ„å»ºé•œåƒ**


```
# æ–°å»ºDockerfileæ–‡ä»¶
touch Dockerfile
# å†™å…¥å¦‚ä¸‹å†…å®¹
FROM node:12.20.1
COPY . /app
WORKDIR /app
RUN npm i
EXPOSE 3000
```


**å‘½ä»¤è§£é‡Š**

- ğŸˆ¯ï¸å®šåŸºç¡€é•œåƒä¸ºnodeï¼Œå†’å·è¡¨ç¤ºæ ‡ç­¾,æ­¤å¤„æŒ‡çš„æ˜¯12.20.1ç‰ˆæœ¬çš„node
- å°†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰(é.dockerignoreæ’é™¤)æ–‡ä»¶ï¼Œéƒ½æ‹·è´è¿›å…¥ image æ–‡ä»¶çš„/appç›®å½•ã€‚
- æŒ‡å®šå·¥ä½œè·¯å¾„ä¸º/appã€‚
- å®‰è£…ä¾èµ–(å®‰è£…åæ‰€æœ‰çš„ä¾èµ–ï¼Œéƒ½å°†æ‰“åŒ…è¿›å…¥imageæ–‡ä»¶)ã€‚
- å°†å®¹å™¨ 3000 ç«¯å£æš´éœ²å‡ºæ¥ï¼Œ å…è®¸å¤–éƒ¨è¿æ¥è¿™ä¸ªç«¯å£ã€‚

**å…¶ä»–å¸¸ç”¨å‘½ä»¤**
![](https://img-blog.csdnimg.cn/20210327135333838.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyODEzNDkx,size_16,color_FFFFFF,t_70#pic_center)



**3. ç¼–å†™.dockerignoreæ’é™¤æ–‡ä»¶**


```
# æ–°å»º.dockerignoreæ’é™¤æ–‡ä»¶
touch .dockerignore
# å†™å…¥å¦‚ä¸‹å†…å®¹
node_modules
```


**4. æ„å»ºé•œåƒ**

koa-serveræ ¹ç›®å½•ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ„å»ºé•œåƒï¼š

```
docker image build -t koa-server-image .
```


- -tç”¨äºæŒ‡å®šæ„å»ºçš„é•œåƒåï¼Œåé¢å¯ç”¨å†’å·æŒ‡å®šæ ‡ç­¾åï¼Œé»˜è®¤latest
- æœ€åçš„é‚£ä¸ªç‚¹è¡¨ç¤º Dockerfile æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ï¼Œå› ä¸ºæ˜¯è¿›å…¥koa-serveråæ‰§è¡Œçš„æ„å»ºå‘½ä»¤ï¼Œæ‰€ä»¥æ˜¯å½“å‰ç›®å½•ï¼Œå¯ä»¥çœ‹æˆæ˜¯./
- åŒé•œåƒåŒæ ‡ç­¾æˆ–ä¸æŒ‡å®šæ ‡ç­¾å¤šæ¬¡æ„å»ºä¼šæ˜¯åŒä¸€ä¸ª
- é•œåƒæ„å»ºå®Œæˆåå¯ç”¨ docker image ls å‘½ä»¤æŸ¥çœ‹é•œåƒåˆ—è¡¨:

![](https://img-blog.csdnimg.cn/20210327135603645.png#pic_center)


**5. å¯åŠ¨å®¹å™¨**

Dockerå†…éƒ¨ç¯å¢ƒä¸ä¸»æœºèµ„æºéƒ½æ˜¯éš”ç¦»çš„ï¼Œå› æ­¤éœ€è¦å®šä¹‰å®¹å™¨ä¸ç‰©ç†æœºçš„ç«¯å£æ˜ å°„æ¥è¿›è¡Œè®¿é—®ã€‚

æ­¤å¤–ï¼Œå®¹å™¨æ˜¯åœ¨é•œåƒåŸºç¡€ä¸Šå¯åŠ¨ï¼Œæ‰€ä»¥è¦å…ˆä¿è¯æœ‰è¿™ä¸ªé•œåƒã€‚å¦‚æœæœ¬åœ°æ²¡æœ‰ï¼Œé»˜è®¤ä¼šå»å…¬å¼€é•œåƒä»“åº“ä¸­æŸ¥æ‰¾åŒåé•œåƒï¼Œæ‰¾åˆ°åæ‹‰å–åˆ°æœ¬åœ°å†æ‰§è¡Œdocker run å‘½ä»¤ã€‚

é•œåƒï¼Œå®¹å™¨ï¼Œåº”ç”¨ç¨‹åºä¸‰è€…å…³ç³»æ˜¯ï¼šé•œåƒæ˜¯å®¹å™¨å¯åŠ¨çš„å…ˆå†³æ¡ä»¶ï¼Œå®¹å™¨ä¸­è¿è¡Œç€çœŸæ­£çš„åº”ç”¨ç¨‹åºã€‚

```
docker container run -p 3000:3000 -it koa-server-image /bin/bash
```
- -på‚æ•°å°±æ˜¯ç”¨äºæŒ‡å®šç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸ºä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£
- -itå‚æ•°ä¸€èˆ¬é…åˆä½¿ç”¨ï¼Œç”Ÿæˆä¸€ä¸ªäº¤äº’ç»ˆç«¯
- /bin/bash ç›¸å½“äºåœ¨-itå‚æ•°è¿”å›çš„äº¤äº’ç»ˆç«¯ä¸­æ‰§è¡Œ/bin/bash 
- å› ä¸ºæ˜¯nodeç¯å¢ƒï¼Œä¸åŠ /bin/bashæ•ˆæœå°±ç›¸å½“äºç»ˆç«¯è¾“å…¥nodeåå›è½¦çš„æ•ˆæœ

**å¯¹äºä¸Šè¿°-på‚æ•°åšä¸€ä¸ªè¡¥å……è¯´æ˜ï¼Œè¿™é‡Œæ¶‰åŠåˆ°äº†dockerä¸­ç”¨äºå¤„ç†ç«¯å£æ˜ å°„çš„docker-proxy ç»„ä»¶ã€‚å½“æˆ‘ä»¬ä½¿ç”¨å¸¦æœ‰-p å‚æ•°çš„docker runå‘½ä»¤ï¼Œè¯¥ç»„ä»¶å°±ä¼šæŠŠå®¹å™¨å†…ç›¸åº”çš„ç«¯å£æ˜ å°„åˆ°ä¸»æœºä¸Šæ¥ï¼Œè¿™æ ·ä¸»æœºå°±å¯ä»¥è®¿é—®å®¹å™¨å†…èµ„æºäº†ã€‚**

**6. æ•ˆæœéªŒè¯**

ä¸Šè¿°å‘½ä»¤æ‰§è¡Œåä¼šè¿”å›ä¸€ä¸ªäº¤äº’ç»ˆç«¯ï¼Œæ­¤æ—¶å·²ç»è¿›å…¥å®¹å™¨å†…éƒ¨ï¼Œé€šè¿‡æ‰§è¡Œnode app.jså¯åŠ¨koa-server

![](https://img-blog.csdnimg.cn/20210327135647167.png#pic_center)


æµè§ˆå™¨è®¿é—®åœ°å€ http://localhost:3000/ ï¼Œé¡µé¢æ˜¾ç¤ºhello koa

![](https://img-blog.csdnimg.cn/20210327135656276.png#pic_center)


å¦‚æœæƒ³é€€å‡ºå®¹å™¨ï¼Œå¯ä»¥å…ˆctrl+cæ‰“æ–­åº”ç”¨ç¨‹åºï¼Œç„¶åctrl+dé€€å‡ºã€‚
å¦‚æœå®‰è£…äº†Docker Desktopï¼Œå¯ç”¨å›¾å½¢åŒ–ç•Œé¢å½¢å¼å»ç®¡ç†é•œåƒå’Œå®¹å™¨ï¼Œååˆ†æ–¹ä¾¿ã€‚

[Docker run å‘½ä»¤](https://www.runoob.com/docker/docker-run-command.html):https://www.runoob.com/docker/docker-run-command.htmlã€‚

## å®¹å™¨è¿ç§»

é€šè¿‡dockeræä¾›çš„exportå’Œimportå‘½ä»¤å¯ä»¥ååˆ†æ–¹ä¾¿çš„å®ç°å®¹å™¨çš„å¯¼å…¥å¯¼å‡ºï¼Œä»è€Œå®Œæˆè¿ç§»å·¥ä½œã€‚

### å¯¼å‡º

```
docker export å®¹å™¨å > xxx.zip
#demo
docker export busybox > busybox.zip
```

æ‰§è¡Œå®Œåä¼šç”Ÿæˆä¸€ä¸ªå‹ç¼©åŒ…ï¼Œå¯å‘é€åˆ°å¦ä¸€å°æœºå­ä¸Šå†å¯¼å…¥ä½¿ç”¨ã€‚

### å¯¼å…¥

å¯¼å‡ºçš„å®¹å™¨åœ¨è¢«å¯¼å…¥åå®é™…ä¼šæˆä¸ºä¸€ä¸ªé•œåƒï¼Œå¯ä½¿ç”¨docker run å‘½ä»¤åŸºäºè¯¥é•œåƒå¯åŠ¨å®¹å™¨ã€‚

```
docker import xxx.zip xxx
# demo 
docker import busybox.zip busybox:test
docker run -it busybox:test sh
```

## å†ä¼š


æƒ…å¦‚é£é›ªæ— å¸¸,

å´æ˜¯ä¸€åŠ¨æ—¢æ®‡ã€‚

æ„Ÿè°¢ä½ è¿™ä¹ˆå¥½çœ‹è¿˜æ¥é˜…è¯»æˆ‘çš„æ–‡ç« ,

æˆ‘æ˜¯å†·æœˆå¿ƒ,ä¸‹æœŸå†è§ã€‚

## æ¨èé˜…è¯»
- [Docker â€”â€” ä»å…¥é—¨åˆ°å®è·µ](https://yeasy.gitbook.io/docker_practice/)
- [Docker å…¥é—¨æ•™ç¨‹](http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html)
- [å¼€å‘è€…å¿…å¤‡çš„ Docker å®è·µæŒ‡å—](https://juejin.cn/book/6844733746462064654)
- [ç”±æµ…å…¥æ·±åƒé€ Docker](https://kaiwu.lagou.com/course/courseInfo.htm?courseId=455#/content)
- [Serverlesså…¥é—¨è¯¾](https://time.geekbang.org/column/intro/305)
- [Dockerå­¦ä¹ ç¬”è®°ä¹‹è¿è¡Œå’Œç®¡ç†å®¹å™¨](https://www.cnblogs.com/JetpropelledSnake/p/10330674.html) 
- [Docker æ¶æ„ä¸­çš„å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µ](https://www.jianshu.com/p/de3184ad0800)



